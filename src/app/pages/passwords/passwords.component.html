<section class="page-controls">
  <div class="container">
    <div class="row no-gutters -between -middle">
      <div class="heading -h3">Passwords</div>
      <div class="btn-group">
        <button class="page-controls_btn btn-white -out-shadow -icon" title="Edit folders" [class.-active]="isEditFolderMode" (click)="editFolders();">
          <i class="icon-edit-folder"></i>
        </button>
        <button class="page-controls_btn btn-white -out-shadow -icon" title="{{isFoldersOpened ? 'Collapse all' : 'Expand all'}}" (click)="isFoldersOpened = !isFoldersOpened;toggleGroups();">
          <i class="icon-next" [class.-rotate180]="isFoldersOpened"></i>
        </button>
        <button class="page-controls_btn btn-white -out-shadow -icon" title="Tiles" [class.-active]="activeViewType == 'tile'" (click)="changeViewType('tile')">
          <i class="icon-tile"></i>
        </button>
        <button class="page-controls_btn btn-white -out-shadow -icon" title="List" [class.-active]="activeViewType == 'list'" (click)="changeViewType('list')">
          <i class="icon-list"></i>
        </button>
      </div>
    </div>
  </div>
</section>
<section class="page-content">
  <div class="container">
    <div class="row no-gutters">
      <app-passwords-group [foldersData]="foldersData" [foldersList]="foldersIdArray" class="col-12"></app-passwords-group>
    </div>
  </div>
</section>

<app-add-menu
  [menuItemsArray]="addMenuItemsArray"
  (triggeredItem)="addMenuClicked($event)">
</app-add-menu>

<app-modal id="folder-modal">
  <div class="modal -folder">
    <div class="modal-header">
      <div class="modal-header_inner">
        <h1 class="modal-header_title heading -h4">Add Folder</h1>
      </div>
      <div class="modal-header_buttons">
        <button class="close-btn" type="button" closeModal data-modal="folder-modal"></button>
      </div>
    </div>
    <div class="modal-content">
      <app-folder
        #folderForm
        [mode]="folderMode"
        [categories]="folders"
        [categoriesIdArray]="foldersIdArray">
      </app-folder>
    </div>
    <div class="modal-bottom">
      <div class="row no-gutters -end">
        <div class="btn-group">
          <button
            class="btn-success"
            type="button"
            closeModal
            data-modal="folder-modal"
            (click)="folderFormCmp.submit()"
            [disabled]="!folderFormCmp.isValid()">Add</button>
          <button class="btn-default" type="button" closeModal data-modal="folder-modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</app-modal>

<app-modal id="item-modal">
  <div class="modal -item" [ngClass]="{'-sidebar-opened': passwordFormCmp.get('previewImage.chooseImage').value}">
    <div class="modal-header">
      <div class="modal-header_inner">
        <h1 class="modal-header_title heading -h4">{{(passwordMode === 'edit') ? 'Edit Password' : 'Add Password'}}</h1>
      </div>
      <div class="modal-header_buttons">
        <button class="close-btn" type="button" closeModal data-modal="item-modal"></button>
      </div>
    </div>
    <div class="modal-content">
      <app-password
        #passwordForm
        [mode]="passwordMode"
        [itemIndex]="listItemSelectedIndex"
        [categoryId]="listSelectedId"
        [categories]="folders"
        [categoriesData]="foldersData">
      </app-password>
    </div>
    <div class="modal-sidebar">
      <div class="row no-gutters -center">
        <button class="btn-primary" type="button" (click)="passwordFormCmp.get('url').valid && updateImagesArray()">Update</button>
      </div>
      <div [loader]="'getImages'">
        <p *ngIf="passwordsImageArray.length === 0;else sidebar_images">Please enter Url.</p>
        <ng-template #sidebar_images>
          <div class="modal-sidebar_images"  style="position: relative">
            <div
              class="image-wrap"
              *ngFor="let img of passwordsImageArray; let i = index"
              [ngClass]="{'-selected': (selectedImage === i)}"
              (click)="selectedImage = i;selectPreviewImage(img)">
              <img src="{{ img }}" alt="">
            </div>
          </div>
        </ng-template>
      </div>
    </div>
    <div class="modal-bottom">
      <div class="row no-gutters -end">
        <div class="btn-group">
          <button
            class="btn-success"
            type="button"
            closeModal
            data-modal="item-modal"
            (click)="passwordFormCmp.submit()"
            [disabled]="!passwordFormCmp.isDirty() || !passwordFormCmp.isValid()">{{(passwordMode === 'edit') ? 'Edit' : 'Add'}}</button>
          <button class="btn-default" type="button" closeModal data-modal="item-modal">Cancel</button>
          <button class="btn-default" type="button" (click)="testInit()">Test</button>
        </div>
      </div>
    </div>
  </div>
</app-modal>

<app-modal id="delete-modal">
  <div class="modal -delete">
    <div class="modal-header">
      <div class="modal-header_inner">
        <h1 class="modal-header_title heading -h4">Delete Password</h1>
      </div>
      <div class="modal-header_buttons">
        <button class="close-btn" type="button" closeModal data-modal="delete-modal"></button>
      </div>
    </div>
    <div class="modal-content">
      <h1 class="heading -h4">Are you sure you want to delete this password?</h1>
    </div>
    <div class="modal-bottom">
      <div class="row no-gutters -end">
        <div class="btn-group">
          <button
            class="btn-success"
            type="button"
            closeModal
            data-modal="delete-modal"
            (click)="deleteItem()">Delete</button>
          <button class="btn-default" type="button" closeModal data-modal="delete-modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</app-modal>
