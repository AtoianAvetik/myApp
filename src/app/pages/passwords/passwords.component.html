<section class="page-controls">
  <div class="container">
    <div class="row no-gutters -between -middle">
      <div class="heading -h3">Passwords</div>
      <div class="btn-group">
        <button class="page-controls_btn btn-white -out-shadow -icon" title="Edit folders" [class.-active]="isEditFolderMode" (click)="editFolders();">
          <i class="icon-edit-folder"></i>
        </button>
        <button class="page-controls_btn btn-white -out-shadow -icon" title="{{isFoldersOpened ? 'Collapse all' : 'Expand all'}}" (click)="isFoldersOpened = !isFoldersOpened;toggleGroups();">
          <i class="icon-next" [class.-rotate180]="isFoldersOpened"></i>
        </button>
        <button class="page-controls_btn btn-white -out-shadow -icon" title="Tiles" [class.-active]="activeViewType == 'tile'" (click)="changeViewType('tile')">
          <i class="icon-tile"></i>
        </button>
        <button class="page-controls_btn btn-white -out-shadow -icon" title="List" [class.-active]="activeViewType == 'list'" (click)="changeViewType('list')">
          <i class="icon-list"></i>
        </button>
      </div>
    </div>
  </div>
</section>
<section class="page-content">
  <div class="container">
    <div class="row no-gutters">
      <app-passwords-group [foldersData]="foldersData" [foldersList]="foldersIdArray" class="col-12"></app-passwords-group>
    </div>
  </div>
</section>

<app-add-menu
  [menuItemsArray]="addMenuItemsArray"
  (triggeredItem)="addMenuClicked($event)">
</app-add-menu>

<app-modal id="folder-modal">
  <div class="modal -folder">
    <div class="modal-header">
      <div class="modal-header_inner">
        <h1 class="modal-header_title heading -h4">Add Folder</h1>
      </div>
      <div class="modal-header_buttons">
        <button class="close-btn" type="button" closeModal data-modal="folder-modal"></button>
      </div>
    </div>
    <div class="modal-content">
      <form id="folder-form" [formGroup]="folderForm" (ngSubmit)="onSubmit()">
        <div class="row -column no-gutters">
          <div class="form-group">
            <label for="folderName">Folder Name:</label>
            <input
              class="form-control"
              id="folderName"
              type="text"
              formControlName="folderName">
          </div>
          <div class="form-group">
            <label for="folderSelect">Add as a subfolder to:</label>
            <select
              name="parentFolderSelect"
              id="parentFolderSelect"
              formControlName="folderSelect">
              <option *ngFor="let folder of folders" [value]="folder.id">{{folder.text}}</option>
            </select>
            <ng-select [allowClear]="true"
                       [items]="folders"
                       (data)="onSelectFolder($event)"
                       placeholder="Choose parent folder"
                       class="page-select">
            </ng-select>
          </div>
        </div>
      </form>
    </div>
    <div class="modal-bottom">
      <div class="row no-gutters -end">
        <div class="btn-group">
          <button
            class="btn-success"
            type="submit"
            closeModal
            data-modal="folder-modal"
            form="folder-form"
            [disabled]="!folderForm.valid">Add</button>
          <button class="btn-default" type="button" closeModal data-modal="folder-modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</app-modal>

<app-modal id="item-modal">
  <div class="modal -item" [ngClass]="{'-sidebar-opened': passwordForm.get('previewImage.chooseImage').value}">
    <div class="modal-header">
      <div class="modal-header_inner">
        <h1 class="modal-header_title heading -h4">{{isEditPasswordMode ? 'Edit Password' : 'Add Password'}}</h1>
      </div>
      <div class="modal-header_buttons">
        <button class="close-btn" type="button" closeModal data-modal="item-modal"></button>
      </div>
    </div>
    <div class="modal-content">
      <form id="password-form" [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
        <div class="row -column no-gutters">
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label for="url">URL:</label>
                <input
                  class="form-control"
                  id="url"
                  type="text"
                  formControlName="url">
              </div>
              <div class="form-group">
                <label for="serviceName">Service Name:</label>
                <input
                  class="form-control"
                  id="serviceName"
                  type="text"
                  formControlName="serviceName">
              </div>
              <div class="form-group">
                <label for="userName">User Name:</label>
                <input
                  class="form-control"
                  id="userName"
                  type="text"
                  formControlName="userName">
              </div>
              <div class="form-group">
                <label for="folderSelect">Folder:</label>
                <select
                  name="folderSelect"
                  id="folderSelect"
                  formControlName="folderSelect">
                  <option *ngFor="let folder of folders" [value]="folder.id">{{folder.text}}</option>
                </select>
                <ng-select
                  [allowClear]="true"
                  [items]="folders"
                  [active]="activeFolder"
                  (data)="onSelectFolder($event)"
                  placeholder="Choose folder"
                  class="page-select">
                </ng-select>
              </div>
              <div class="form-group">
                <label for="email">Email:</label>
                <input
                  class="form-control"
                  id="email"
                  type="text"
                  formControlName="email">
              </div>
              <div class="form-group">
                <label for="pass">Password:</label>
                <input
                  class="form-control"
                  id="pass"
                  type="text"
                  formControlName="pass">
              </div>
            </div>
            <div class="col-6" formGroupName="previewImage">
              <div class="form-group">
                <label for="imageUrl">Preview image:</label>
                <input
                  id="imageUrl"
                  class="form-control"
                  type="text"
                  placeholder="Enter image address"
                  [(ngModel)]="previewImage"
                  formControlName="imageUrl">
              </div>
              <div class="row">
                <div class="col-6 form-group -upload">
                  <input
                    id="uploadImage"
                    class="form-control"
                    type="file"
                    name="uploadImage"
                    (change)="uploadImage($event)"
                    formControlName="uploadImage">
                  <label for="uploadImage" class="btn-success">
                    <i class="icon-upload"></i>
                    Local file
                  </label>
                </div>
                <div *ngIf="passwordForm.get('url').valid" class="col-6 form-group -switch row no-gutters -end -middle">
                  <label for="chooseImage">
                    <input
                      id="chooseImage"
                      class="form-control"
                      type="checkbox"
                      name="chooseImage"
                      formControlName="chooseImage">
                    <span class="slider -round"></span>
                  </label>
                </div>
              </div>
              <div class="form-group">
                <div class="image-wrap">
                  <img *ngIf="passwordForm.get('previewImage.imageUrl').valid" src="{{ previewImage }}" alt="">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="pass">Description:</label>
                <textarea
                  class="form-control"
                  id="desc"
                  rows="5"
                  formControlName="desc">
                </textarea>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="accordion-group" formGroupName="additionalOptions">
                <app-accordion
                  [heading]="'Additional options'">
                  1
                </app-accordion>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="modal-sidebar">
      <p *ngIf="passwordsImageArray.length === 0;else sidebar_images">Please enter Url.</p>
      <ng-template #sidebar_images>
        <div class="modal-sidebar_images">
          <div
            class="image-wrap"
            *ngFor="let img of passwordsImageArray; let i = index"
            [ngClass]="{'-selected': (selectedImage === i)}"
            (click)="selectedImage = i;selectPreviewImage(img)">
            <img src="{{ img }}" alt="">
          </div>
        </div>
      </ng-template>
    </div>
    <div class="modal-bottom">
      <div class="row no-gutters -end">
        <div class="btn-group">
          <button
            class="btn-success"
            type="submit"
            closeModal
            data-modal="item-modal"
            form="password-form"
            [disabled]="!passwordForm.dirty || !passwordForm.valid">{{isEditPasswordMode ? 'Edit' : 'Add'}}</button>
          <button class="btn-default" type="button" closeModal data-modal="item-modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</app-modal>

<app-modal id="delete-modal">
  <div class="modal -delete">
    <div class="modal-header">
      <div class="modal-header_inner">
        <h1 class="modal-header_title heading -h4">Delete Password</h1>
      </div>
      <div class="modal-header_buttons">
        <button class="close-btn" type="button" closeModal data-modal="delete-modal"></button>
      </div>
    </div>
    <div class="modal-content">
      <h1 class="heading -h4">Are you sure you want to delete this password?</h1>
    </div>
    <div class="modal-bottom">
      <div class="row no-gutters -end">
        <div class="btn-group">
          <button
            class="btn-success"
            type="button"
            closeModal
            data-modal="delete-modal"
            form="password-form"
            (click)="onSubmit()">Delete</button>
          <button class="btn-default" type="button" closeModal data-modal="delete-modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</app-modal>
